<div class="case-management-container" *ngIf="isBrowser">
      <!-- Header -->
      <div class="app-header">
        <h1>{{ title }}</h1>
        <div class="header-actions">
          <span class="user-info">Welcome, Current User</span>
        </div>
      </div>

      <!-- Stages Header -->
      <div class="stages-container">
        <div class="stages-header">
          <h2>Case Management Process</h2>
          <p class="stages-subtitle">Track your case progress through each stage</p>
        </div>
        <div class="stages-track">
          <div *ngFor="let stage of stages; let i = index" 
               class="stage-item"
               [class.active]="stage.isActive"
               [class.completed]="stage.isCompleted">
            <div class="stage-circle">
              <i *ngIf="stage.isCompleted" class="dx-icon-check"></i>
              <span *ngIf="!stage.isCompleted">{{ i + 1 }}</span>
            </div>
            <div class="stage-content">
              <div class="stage-label">{{ stage.name }}</div>
              <div class="stage-description">{{ stage.description }}</div>
            </div>
            <div *ngIf="i < stages.length - 1" class="stage-connector"></div>
          </div>
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="main-content">
        <!-- Left Panel -->
        <div class="left-panel">
          <div class="panel-card">
            <div class="panel-header">
              <h3>Case Management</h3>
            </div>
            
            <!-- Create Case Button -->
            <dx-button 
              text="Create Case" 
              type="success" 
              icon="plus"
              (onClick)="showCreateCasePopup()"
              class="create-case-btn">
            </dx-button>
            
            <!-- Search Box -->
            <div class="search-container">
              <dx-text-box
                placeholder="Search by case number or party name..."
                [(value)]="searchValue"
                (onValueChanged)="onSearchValueChanged($event)"
                class="search-input">
                <dxi-button 
                  name="search"
                  location="after"
                  options="{
                    icon: 'search',
                    type: 'default'
                  }">
                </dxi-button>
              </dx-text-box>
            </div>

            <!-- Cases Grid -->
            <div class="grid-container">
              <div class="grid-header">
                <h4>All Cases ({{ leftGridData.length }})</h4>
                <span class="grid-subtitle">Select a case to view details</span>
              </div>
              
              <dx-data-grid
                [dataSource]="leftGridData"
                [showBorders]="true"
                [rowAlternationEnabled]="true"
                [columnAutoWidth]="true"
                [allowColumnReordering]="true"
                [showRowLines]="true"
                [showColumnLines]="false"
                [selectedRowKeys]="selectedCase ? [selectedCase.id] : []"
                keyExpr="id"
                (onSelectionChanged)="onLeftGridSelectionChanged($event)"
                class="cases-grid">
                
                <dxi-column dataField="caseNo" caption="Case No" [width]="130">
                </dxi-column>
                
                <dxi-column dataField="investigateParty" caption="Investigate Party">
                </dxi-column>
              </dx-data-grid>
            </div>
          </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
          <div class="panel-card">
            <div class="panel-header">
              <h3>Case Details</h3>
              <span *ngIf="selectedCase" class="selected-case">{{ selectedCase.caseNo }}</span>
            </div>
            
            <div *ngIf="!selectedCase" class="no-selection">
              <div class="no-selection-icon">
                <i class="dx-icon-folder"></i>
              </div>
              <h4>No Case Selected</h4>
              <p>Select a case from the left panel to view detailed information</p>
            </div>

            <div *ngIf="selectedCase" class="case-details">
              <!-- Investigation Details Grid -->
              <div class="detail-card">
                <h4>Investigation Details</h4>
                <dx-data-grid
                  [dataSource]="rightGridData"
                  [showBorders]="true"
                  [rowAlternationEnabled]="true"
                  [columnAutoWidth]="true"
                  [showRowLines]="true"
                  class="details-grid">
                  
                  <dxi-column dataField="caseNo" caption="Case No"></dxi-column>
                  <dxi-column dataField="investigateParty" caption="Investigate Party"></dxi-column>
                  <dxi-column dataField="roleType" caption="Role Type"></dxi-column>
                  <dxi-column dataField="regulatedParty" caption="Regulated Party"></dxi-column>
                </dx-data-grid>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Create Case Popup -->
      <dx-popup
        [(visible)]="createCasePopupVisible"
        [width]="900"
        [height]="700"
        title="Create New Case"
        [showCloseButton]="true"
        [dragEnabled]="true"
        [resizeEnabled]="true">
        
        <div *dxTemplate="let data of 'content'">
          <dx-tab-panel
            [dataSource]="tabPanelItems"
            [selectedIndex]="0"
            [animationEnabled]="true"
            [swipeEnabled]="false"
            class="case-tabs">
            
            <!-- Case Tab Template -->
            <div *dxTemplate="let tabData of 'caseTab'">
              <div class="tab-content">
                <!-- Area Description Card -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-doc"></i> Area</h4>
                    <span class="required">*</span>
                  </div>
                  <dx-text-area
                    placeholder="Enter area description..."
                    [(value)]="caseForm.area"
                    [height]="100"
                    class="form-control">
                  </dx-text-area>
                </div>

                <!-- Regulated Party Card -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-group"></i> Regulated Party</h4>
                    <span class="required">*</span>
                  </div>
                  
                  <div class="form-grid">
                    <div class="form-row">
                      <label class="form-label">Part:</label>
                      <dx-select-box
                        [dataSource]="partOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Part..."
                        [(value)]="caseForm.part"
                        class="form-control">
                      </dx-select-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Role Type:</label>
                      <dx-select-box
                        [dataSource]="roleTypeOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Role Type..."
                        [(value)]="caseForm.roleType"
                        class="form-control">
                      </dx-select-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Regulated Party:</label>
                      <dx-select-box
                        [dataSource]="regulatedPartyOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Regulated Party..."
                        [(value)]="caseForm.regulatedParty"
                        class="form-control">
                      </dx-select-box>
                    </div>
                  </div>
                </div>

                <!-- Documents Card -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-attach"></i> Documents</h4>
                  </div>
                  <dx-file-uploader
                    [multiple]="true"
                    accept=".pdf,.doc,.docx,.jpg,.png,.xlsx"
                    uploadMode="useButtons"
                    [showFileList]="true"
                    (onValueChanged)="onFileUploaded($event)"
                    class="file-uploader">
                  </dx-file-uploader>
                  <div class="upload-help">
                    <span>Add Supporting document(s)</span>
                  </div>
                </div>

                <!-- Investigation Checkbox -->
                <div class="form-card">
                  <dx-check-box
                    text="Investigate this Regulated party?"
                    [(value)]="caseForm.investigateRegulatedParty"
                    class="investigate-checkbox">
                  </dx-check-box>
                </div>
              </div>
            </div>

            <!-- Investigation Tab Template -->
            <div *dxTemplate="let tabData of 'investigationTab'">
              <div class="tab-content">
                <!-- Area Description -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-search"></i> Area</h4>
                  </div>
                  <dx-text-area
                    placeholder="Enter area description..."
                    [(value)]="investigationForm.area"
                    [height]="80"
                    class="form-control">
                  </dx-text-area>
                </div>

                <!-- Regulated Party -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-group"></i> Regulated Party</h4>
                  </div>
                  
                  <div class="form-grid">
                    <div class="form-row">
                      <label class="form-label">Part:</label>
                      <dx-select-box
                        [dataSource]="partOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Part..."
                        [(value)]="investigationForm.part"
                        class="form-control">
                      </dx-select-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Role Type:</label>
                      <dx-select-box
                        [dataSource]="roleTypeOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Role Type..."
                        [(value)]="investigationForm.roleType"
                        class="form-control">
                      </dx-select-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Regulated Party:</label>
                      <dx-select-box
                        [dataSource]="regulatedPartyOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Regulated Party..."
                        [(value)]="investigationForm.regulatedParty"
                        class="form-control">
                      </dx-select-box>
                    </div>
                  </div>
                </div>

                <!-- Investigation Type -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-event"></i> Investigation Type</h4>
                  </div>
                  
                  <div class="form-row-with-button">
                    <div class="form-field-group">
                      <label class="form-label">Event Type:</label>
                      <dx-select-box
                        [dataSource]="eventTypeOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Event Type..."
                        [(value)]="investigationForm.eventType"
                        class="form-control-flex">
                      </dx-select-box>
                    </div>
                    <dx-button
                      text="Add"
                      type="default"
                      icon="plus"
                      (onClick)="addEventType()"
                      class="add-btn">
                    </dx-button>
                  </div>
                </div>

                <!-- Complainant -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-user"></i> Complainant</h4>
                  </div>
                  
                  <div class="form-grid">
                    <div class="form-row">
                      <label class="form-label">Name:</label>
                      <dx-text-box
                        placeholder="Enter name"
                        [(value)]="investigationForm.complainantName"
                        class="form-control">
                      </dx-text-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Surname:</label>
                      <dx-text-box
                        placeholder="Enter surname"
                        [(value)]="investigationForm.complainantSurname"
                        class="form-control">
                      </dx-text-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Email:</label>
                      <dx-text-box
                        placeholder="Enter email"
                        [(value)]="investigationForm.complainantEmail"
                        class="form-control">
                      </dx-text-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Relationship Type:</label>
                      <dx-select-box
                        [dataSource]="relationshipTypeOptions"
                        displayExpr="text"
                        valueExpr="value"
                        placeholder="Select Relationship Type..."
                        [(value)]="investigationForm.relationshipType"
                        class="form-control">
                      </dx-select-box>
                    </div>
                    
                    <div class="form-row">
                      <label class="form-label">Contact Number:</label>
                      <div class="contact-number-container">
                        <dx-text-box
                          placeholder="Code"
                          [(value)]="investigationForm.contactCode"
                          class="contact-code">
                        </dx-text-box>
                        <dx-text-box
                          placeholder="Phone number"
                          [(value)]="investigationForm.contactNumber"
                          class="contact-number">
                        </dx-text-box>
                      </div>
                    </div>
                    
                    <div class="form-row-with-button">
                      <div class="form-field-group">
                        <label class="form-label">Entity:</label>
                        <dx-text-box
                          placeholder="Enter entity"
                          [(value)]="investigationForm.entity"
                          class="form-control-flex">
                        </dx-text-box>
                      </div>
                      <dx-button
                        text="Add"
                        type="default"
                        icon="plus"
                        (onClick)="addEntity()"
                        class="add-btn">
                      </dx-button>
                    </div>
                  </div>
                </div>

                <!-- Documents -->
                <div class="form-card">
                  <div class="form-card-header">
                    <h4><i class="dx-icon-attach"></i> Documents</h4>
                  </div>
                  <dx-file-uploader
                    [multiple]="true"
                    accept=".pdf,.doc,.docx,.jpg,.png,.xlsx"
                    uploadMode="useButtons"
                    [showFileList]="true"
                    (onValueChanged)="onInvestigationFileUploaded($event)"
                    class="file-uploader">
                  </dx-file-uploader>
                  <div class="upload-help">
                    <span>Add Supporting document(s)</span>
                  </div>
                </div>
              </div>
            </div>
          </dx-tab-panel>

          <!-- Popup Actions -->
          <div class="popup-actions">
            <div class="action-buttons">
              <dx-button
                text="Cancel"
                type="normal"
                icon="close"
                (onClick)="closeCreateCasePopup()"
                class="action-btn cancel-btn">
              </dx-button>
              <dx-button
                text="Save Case"
                type="success"
                icon="save"
                (onClick)="saveCase()"
                class="action-btn save-btn">
              </dx-button>
            </div>
          </div>
        </div>
      </dx-popup>
    </div>

    <div class="ssr-loading" *ngIf="!isBrowser">
      <div class="loading-container">
        <h1>Case Management System</h1>
        <p>Loading application...</p>
        <div class="spinner"></div>
      </div>
    </div>